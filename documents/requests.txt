
by function
    travel
        sea npc ON

            longer routes from
                london

                    broadcast to nearby players only ON
                        9 grids algorithm

                        ######## pVe
                        player sees npcs
                            one map has many grids
                            one grid has many roles
                            visible_grids has 9 grids

                            ######## at sea
                            at sea

                                on enter sea
                                    npcs are in grids

                                    when player enters sea, put player in grid
                                    p gets visible_grids
                                    p gets npcs(and other ps) in visible_grids

                                on leave(to port)
                                    players are in grids

                                    when player enters port, put player in grid
                                    p gets visible_grids
                                    p gets other players in visible_grids


                                on move
                                    move within center grid
                                        pass
                                    move across grid (8 directions)
                                        tell server grid change
                                            remove role from pre_grid
                                            add role to next_grid
                                        server tell player
                                            new roles in new grids(3)
                                            disappeared roles in old grids(3)

                            ######## in battle
                            in battle

                        ######## pVp
                        player sees player
                            login OK


                            move ON
                                in my grid OK
                                cross my grid ON
                                    basic OK
                                    others see me cross grid OK
                                    4 additional directions OK

                            sail OK

                            sail 4 additional directions issue OK



                            enter port

                            battle with






                    west africa
                    east africa
                    india
                    asia


                amsterdam

                lisbon
                seville

                genoa
                istanbul






            broadcast to nearby players only

            can't sail from Belgrade
            port npcs positions wrong (lisbon)
    trade



    fight


by structure
    buildings
    buttons on interface